!function(e,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a():"function"==typeof define&&define.amd?define(a):(e="undefined"!=typeof globalThis?globalThis:e||self).CoupangSeoWebLog=a()}(this,(function(){"use strict";var e,a,o;!function(e){e.production="production",e.development="development"}(e||(e={})),function(e){e.SRP="SRP",e.PLP="PLP",e.SDP="SDP",e.GW="GW",e.SHOP="SHOP",e.PROMOTIONS="PROMOTIONS",e.TODAY_OPEN="TODAY_OPEN",e.BRAND_SHOP="BRAND_SHOP",e.OMP="OMP",e.COUPANG_BENEFITS="COUPANG_BENEFITS",e.BEST_100="BEST_100",e.WOW_CARD="WOW_CARD"}(a||(a={})),function(e){e.PCWeb="web",e.MWeb="mweb"}(o||(o={}));const n={enabled:!0,platform:o.PCWeb,cookieEnabled:!1,sdkVersion:"0.0.5",sources:[{name:"Google",referrer:[".google."],campaign:{spec:"10917115",src:"4502016"}},{name:"Naver",referrer:["naver.com","search.naver.com","m.search.naver.com","m.naver.com"],exclude:["adcr.naver.com"],campaign:{spec:"10917115",src:"4502001"}},{name:"Daum",referrer:[".daum."],campaign:{spec:"10917115",src:"4502002"}},{name:"Bing",referrer:[".bing."],campaign:{spec:"10917115",src:"4502888"}},{name:"Yahoo",referrer:[".yahoo."],campaign:{spec:"10917115",src:"4502887"}}],paths:[{page:"SDP",pattern:["www.coupang.com/vp/products"],addtag:"400"},{page:"PLP",pattern:["www.coupang.com/np/categories","www.coupang.com/np/campaigns","www.coupang.com/np/coupangglobal"],addtag:"300"},{page:"GW",pattern:["^https://www.coupang.com/$"],addtag:"900"},{page:"SRP",pattern:["www.coupang.com/np/search"],addtag:"200"},{page:"SHOP",pattern:["https://shop.coupang.com/.+"],addtag:"700"},{page:"PROMOTIONS",pattern:["https://pages.coupang.com/p/.+","www.coupang.com/vp/promotions/\\d+/event"],addtag:"26"},{page:"TODAY_OPEN",pattern:["www.coupang.com/np/todayopen","https://www.coupang.com/np/todayopen/categories"],addtag:"31"},{page:"BRAND_SHOP",pattern:["www.coupang.com/np/products/brand-shop"],addtag:"61"},{page:"OMP",pattern:["www.coupang.com/np/omp"],addtag:"71"},{page:"COUPANG_BENEFITS",pattern:["www.coupang.com/np/coupangbenefit"],addtag:"81"},{page:"BEST_100",pattern:["www.coupang.com/np/best100/bestseller","www.coupang.com/np/best100/trending"],addtag:"41"},{page:"WOW_CARD",pattern:["www.coupang.com/vp/wowcard"],addtag:"51"}]},t={enabled:!0,platform:o.MWeb,cookieEnabled:!1,sdkVersion:"0.0.5",sources:[{name:"Google",referrer:[".google."],campaign:{spec:"10917115",src:"4503016"}},{name:"Naver",referrer:["naver.com","search.naver.com","m.search.naver.com","m.naver.com"],exclude:["adcr.naver.com"],campaign:{spec:"10917115",src:"4503001"}},{name:"Daum",referrer:[".daum."],campaign:{spec:"10917115",src:"4503002"}},{name:"Bing",referrer:[".bing."],campaign:{spec:"10917115",src:"4503888"}},{name:"Yahoo",referrer:[".yahoo."],campaign:{spec:"10917115",src:"4503887"}}],paths:[{page:"SDP",pattern:["m.coupang.com/vm/products"],addtag:"400"},{page:"PLP",pattern:["m.coupang.com/nm/plp","coupang.com/nm/section/sm/617","coupang.com/nm/section/sm/609","coupang.com/nm/section/sm/542"],addtag:"300"},{page:"GW",pattern:["^https://m.coupang.com/$"],addtag:"900"},{page:"SRP",pattern:["m.coupang.com/nm/search"],addtag:"200"},{page:"SHOP",pattern:["^https://shop.coupang.com/.+"],addtag:"700"},{page:"PROMOTIONS",pattern:["https://pages.coupang.com/m/.+"],addtag:"26"},{page:"COUPANG_BENEFITS",pattern:["coupang.com/nm/section/collection/homeEvent"],addtag:"81"},{page:"WOW_CARD",pattern:["m.coupang.com/vm/wowcard"],addtag:"51"}]},r={[o.PCWeb]:n,[o.MWeb]:t};var c={getCookie(e){let a;const o=e+"=",n=decodeURIComponent(document.cookie).split(";");for(a=0;a<n.length;a++){let e=n[a];for(;" "===e.charAt(0);)e=e.substring(1);if(0===e.indexOf(o))return e.substring(o.length,e.length)}return""},setCookie(e,a,o,n,t,r){const c=new Date(2100,1,1),i=(e=>{const a=e.split(".");return 3!==a.length&&4!==a.length?e:e.replace(/^(?:[\w\d]+\.)?([^:/]*).*$/i,"$1")})(decodeURIComponent(document.domain)),g=[];g.push(`${e}=${encodeURIComponent(a)}`),g.push(`; expires=${o&&o.toUTCString()||c.toUTCString()}`),g.push(`; domain=${n||i}`),g.push(`; path=${t||"/"}`),g.push(r&&"; secure"),document.cookie=g.join("")}},i={COOKIE:{PCID:"PCID",MEMBERSRL:"member_srl",ISAPP:"ISAPP",CAMPAIGN:["trac_src","trac_spec","trac_addtag","trac_ctag","trac_lptag"]}},g={getCampaignParameter(){const e={};return i.COOKIE.CAMPAIGN.map((a=>{const o=a.replace(/^trac_/,""),n=c.getCookie(a).replace(/"/g,"");e[o]="0"!==n&&n||""})),e.src&&e.spec&&{campaign:e}||{}},setCampaignParameter(e){i.COOKIE.CAMPAIGN.map((a=>{const o=a.replace(/^trac_/,""),n=e[o]||"";c.setCookie(a,n)}))}};const p=(e,a,o,n)=>{let t="";return t+=`%c[${e}/${a}]`,t+=` :  ${o}`,{message:t,color:n=`color: ${n};`}};var s={isDebugEnabled:!1,setDebugMode:function(){this.isDebugEnabled=!0},d:function(e,a){if(window?.console&&this.isDebugEnabled){const o=p("Debug",e,a,"purple");o.color?console.log(o.message,o.color):console.log(o.message)}},i:function(e,a){if(window?.console&&this.isDebugEnabled){const o=p("Info",e,a,"green");o.color?console.info(o.message,o.color):console.info(o.message)}},w:function(e,a){if(window?.console&&this.isDebugEnabled){const o=p("Warn",e,a,"orange");o.color?console.warn(o.message,o.color):console.warn(o.message)}},e:function(e,a){if(window?.console&&this.isDebugEnabled){const o=p("Error",e,a,"red");o.color?console.error(o.message,o.color):console.error(o.message)}}};const m="SEOWebLog",d="data-seo-rule",u="data-mode";return new class{campaignParameter;constructor(){if(window.CoupangSeoWebLog)return;if(!window.CoupangWebLog)return s.setDebugMode(),void s.w(m,"#constructor - Not found window.CoupangWebLog(#coupang-web-log) for initialize");const a=document.getElementById("seo-js-sdk");if(a){"production"!==(a.getAttribute(u)||"production")&&s.setDebugMode();const o={seoRule:JSON.parse(a.getAttribute(d))||undefined,mode:a.getAttribute(u)||e.production};s.d(m,"#constructor - use custom attribute(data-mode, data-seo-rule) for initialize"),this.init(o)}else s.d(m,"#constructor - Not found script tag(#seo-js-sdk) for initialize")}refactorInitData(e){const{cookieEnabled:a,sources:n,paths:t}=(c=e?.seoRule?.platform||o.PCWeb,r[c]);var c;return{...e,seoRule:{cookieEnabled:a,sources:n,paths:t,...e?.seoRule}}}init(a){s.d(m,`#init -\n${JSON.stringify(a,undefined,2)}`);const o=this.refactorInitData(a),n=this.getEffectiveTrafficData(o);if(n){const{path:a,source:t}=n;s.d(m,`#init - Effective SEO Traffic: Source name: ${t?.name}  Path page: ${a?.page}`);const r={meta:{schemaId:o?.mode===e.production?14506:8261,schemaVersion:1},data:{logCategory:"campaign",logType:"landing",domain:"SEO",pageName:a?.page||"",eventName:"seo_traffic_landing",page:a?.page||"",source:t?.name||"",landingUrl:window.location?.href,referrerUrl:window.document.referrer}},c=o?.seoRule?.cookieEnabled,i={...t?.campaign,addtag:a?.addtag,...this.getCTag(a)};c&&(this.rewriteCampaignCookie(i),s.d(m,"#init - Campaign cookie has been rewritten")),s.d(m,`#init - Cookie CampaignParameter \n${JSON.stringify(g.getCampaignParameter(),undefined,2)}`),s.d(m,`#init - Before rewrite WebLog CampaignParameter \n${JSON.stringify(window.CoupangWebLog.campaignParameter,undefined,2)}`),this.rewriteWebLogCampaignParameter(i),s.d(m,`#init - After rewrite WebLog CampaignParameter \n${JSON.stringify(window.CoupangWebLog.campaignParameter,undefined,2)}`),window.CoupangWebLog?.submit(r),s.d(m,"#init - SEO log has been sent."),c||(this.resetWebLogCampaignParameter(),s.d(m,`#init - After reset WebLog CampaignParameter \n${JSON.stringify(window.CoupangWebLog.campaignParameter,undefined,2)}`))}else s.d(m,"#init - Uneffective SEO Traffic");return this}getCTag(e){if(e?.page===a.SRP){const e=new URLSearchParams(window.location?.search),a=e?.get("q");return{ctag:a,lptag:a}}if(e?.page===a.PLP){const e="/np/coupangglobal"===window.location.pathname?"coupangglobal":/(nm\/plp|np\/categories|np\/campaigns|nm\/section\/sm)\/([0-9]*)/.exec(window.location.pathname)?.[2];return{ctag:e,lptag:e}}if(e?.page===a.SDP){const e=/v[p|m]\/products\/(quick-view\/){0,}([0-9]*)/.exec(window.location.pathname)?.[2];return{ctag:e,lptag:e}}if(e?.page===a.GW)return{ctag:"home",lptag:"coupang"};if(e?.page===a.SHOP){const e=window.__NUXT__?.state?.store?.vendorId||"";return{ctag:e,lptag:e}}if(e?.page===a.PROMOTIONS){let e="";return e=window.location.pathname.endsWith("/event")?/vp\/promotions\/(\d+)\/event/.exec(window.location.pathname)[1]:/[p|m]\/([0-9]*)/.exec(window.location.pathname)?.[1],{ctag:e,lptag:e}}if(e?.page===a.TODAY_OPEN){const e="/np/todayopen"===window.location.pathname?"todayopen":/np\/todayopen\/categories\/([0-9]*)/.exec(window.location.pathname)?.[1];return{ctag:e,lptag:e}}if(e?.page===a.BRAND_SHOP){const e=new URLSearchParams(window.location?.search),a=e?.get("brandName");return{ctag:a,lptag:a}}if(e?.page===a.OMP)return{ctag:"omp",lptag:"omp"};if(e?.page===a.COUPANG_BENEFITS)return{ctag:"coupangbenefit",lptag:"coupangbenefit"};if(e?.page===a.BEST_100){const e=/np\/best100\/(bestseller|trending)\/([0-9]*)/.exec(window.location.pathname)?.[2];return{ctag:e??"Best100",lptag:e??"Best100"}}return e?.page===a.WOW_CARD?{ctag:"wowcard",lptag:"wowcard"}:{ctag:"",lptag:""}}getEffectiveTrafficData(e){if(this.isRobot()||this.isExclude())return;const a=this.getSeoSourceByReferrer(e);if(!a)return;const o=this.getSeoPathByUrl(e);return o?{source:a,path:o}:void 0}isRobot(){const e=window.navigator.userAgent;return/bot|googlebot|crawler|spider|robot|crawling/i.test(e)}isExclude(){const e=new URLSearchParams(window.location?.search);if(["src","spec","addtag","lptag","ctag"].some((a=>e.has(a))))return!0}getSeoSourceByReferrer(e){const a=window.document.referrer;if(!a||!function(e){try{return new URL(e),!0}catch(a){return!1}}(a))return;const o=new URL(a),n=e?.seoRule?.sources?.find((e=>e.referrer.some((e=>o?.host?.includes(e)))&&!e.exclude?.some((e=>o?.host?.includes(e)))));return n}getSeoPathByUrl(e){const{protocol:a,hostname:o,pathname:n}=window.location,t=`${a}//${o}${n}`,r=e?.seoRule?.paths?.find((e=>e.pattern?.some((e=>t.match(new RegExp(e))))));return r}rewriteCampaignCookie(e){g.setCampaignParameter(e)}rewriteWebLogCampaignParameter(e){this.campaignParameter=window.CoupangWebLog.campaignParameter,window.CoupangWebLog.campaignParameter={...window.CoupangWebLog.campaignParameter,campaign:{...window.CoupangWebLog.campaignParameter?.campaign,...e}}}resetWebLogCampaignParameter(){window.CoupangWebLog.campaignParameter=this.campaignParameter,this.campaignParameter=null}}}));
//# sourceMappingURL=seo-js-sdk.umd.min.js.map
