!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).CoupangWebLog=t()}(this,(function(){"use strict";const e=(e,t,n,r)=>{let i="";return i+=`%c[${e}/${t}]`,i+=` :  ${n}`,{message:i,color:r=`color: ${r};`}};var t={isDebugEnabled:!1,setDebugMode:function(){this.isDebugEnabled=!0},d:function(t,n){if(window?.console&&this.isDebugEnabled){const r=e("Debug",t,n,"purple");r.color?console.log(r.message,r.color):console.log(r.message)}},i:function(t,n){if(window?.console&&this.isDebugEnabled){const r=e("Info",t,n,"green");r.color?console.info(r.message,r.color):console.info(r.message)}},w:function(t,n){if(window?.console&&this.isDebugEnabled){const r=e("Warn",t,n,"orange");r.color?console.warn(r.message,r.color):console.warn(r.message)}},e:function(t,n){if(window?.console&&this.isDebugEnabled){const r=e("Error",t,n,"red");r.color?console.error(r.message,r.color):console.error(r.message)}}};const n=Object.freeze({V1:{SINGLE_SUBMIT:"weblog/submit"},V2:{SINGLE_SUBMIT:"api/v2/submit"}}),r=Object.freeze({KR:{"public":{production:"ljc.coupang.com",integration:"ljc-test.coupang.com",develop:"ljc-test.coupang.com",internal:"ljc.coupangdev.com"},"private":{production:"ljc-private.coupang.net",integration:"ljc-test-private.coupang.net",develop:"ljc-test-private.coupang.net",internal:"ljc.coupangdev.com"}},TW:{"public":{production:"ljc.tw.coupang.com",integration:"ljc-test.tw.coupang.com",develop:"ljc-test.tw.coupang.com",internal:"ljc.coupangdev.com"},"private":{production:"ljc-private.tw.coupang.net",integration:"ljc-test-private.coupang.net",develop:"ljc-test-private.coupang.net",internal:"ljc.coupangdev.com"}}}),i=["coupang.net","coupangdev.com"];class a{appCode;host;mode;market;usePrivateELB;useV2API;baseUrl;constructor({appCode:e,host:t,market:n,mode:r="production",privateELB:i,useV2API:a}){if(t&&!t.startsWith("https://"))throw new Error("host param should be starts with https://");this.appCode=e,this.host=t,this.market=n,this.mode=r,this.useV2API=a,this.usePrivateELB=this.shouldUsePrivateELB(i),this.baseUrl=this.host||this.getBaseUrl()}getSingleSubmitEndpoint(){return this.useV2API?`${this.baseUrl}/${n.V2.SINGLE_SUBMIT}?appCode=${this.appCode}&market=${this.market}`:`${this.baseUrl}/${n.V1.SINGLE_SUBMIT}/${this.appCode}`}getBaseUrl(){const e=(r[this.market]||r.KR)[this.usePrivateELB?"private":"public"];return`https://${e[this.mode]||e.develop}`}shouldUsePrivateELB(e){if(!e||"auto"===e.toLowerCase()){const e=document.location.protocol.toLowerCase();if("http"===e||"https"===e){const e=document.location.hostname||document.location.host.split(":")[0];for(const n of i)if(e.toLowerCase().endsWith(n))return t.d("EndPointsConfig",`#shouldUsePrivateELB - detected private ELB pageHost: ${e}, privateDomain: ${n}`),!0}}return"true"===e}}class s{endpointsConfig;constructor(e){this.endpointsConfig=new a({...e})}resolveEndpoints(){return{singleSubmitEndpoint:this.endpointsConfig.getSingleSubmitEndpoint()}}}var o={meta:{schemaId:14044,schemaVersion:1},data:{logCategory:"event",logType:"click"}},c={meta:{schemaId:14043,schemaVersion:1},data:{logCategory:"impression",logType:"impression"}},m={meta:{schemaId:14042,schemaVersion:1},data:{logCategory:"view",logType:"page",eventName:"default page view"}},d={generate(){let e,t="";for(e=0;e<32;e++){const n=16*Math.random()|0;8!==e&&12!==e&&16!==e&&20!==e||(t+="-"),t+=(12===e?4:16===e?3&n|8:n).toString(16)}return t}},u={isVisible(e){const t=e.getBoundingClientRect();return!("none"===window.getComputedStyle(e).display||"hidden"===window.getComputedStyle(e).visibility||t.width<=1||t.height<=1)},isVisibleLongerThanMinTime(e=[],t){let n=0,r=0,i=0;for(let a=0;a<e.length;a++){const s=e[a];if(s.isVisible?(r=s.ts,a===e.length-1&&(i=performance.now())):i=s.ts,i>r&&(n=i-r),n>=t)return!0}return!1},getElemToTrackForClick(e){if(["BUTTON","A"].includes(e.tagName))return e;if(e.dataset.componentName||e.id)return e;for(;e.parentElement;){if("BODY"===(e=e.parentElement).tagName)return null;if(e.dataset.componentName)return e}return null}},g={getPlatform(e){const t=e.trim().toLowerCase();return"android"!==t&&"ios"!==t||this.hasAndroidFunction()||this.hasIOSFunction()?t:"mweb"},isApp(){return this.hasAndroidFunction()||this.hasIOSFunction()},hasAndroidFunction:()=>"function"==typeof window?.CoupangAppTracking?.logEvent,hasIOSFunction:()=>"function"==typeof window?.webkit?.messageHandlers?.callBackHandler?.postMessage};class p{schemaId;schemaVersion;setSchemaId(e){return this.schemaId=e,this}setSchemaVersion(e){return this.schemaVersion=e,this}getJSON(){const{schemaId:e,schemaVersion:t}=this;return{meta:{schemaId:e,schemaVersion:t}}}}class l{data;constructor(){this.data={}}setData(e){return this.data=e,this}getJSON(){return{data:this.data}}}class h{sentTime;extraData;setExtraData(e){return this.extraData=e,this}setSentTime(e){return this.sentTime=e,this}getJSON(){const{sentTime:e,extraData:t}=this;return{extra:{sentTime:e,...t}}}}const f="ParameterStore";class w{static DYNAMIC_VALUE_FLAG="@";static REGEXP_DYNAMIC_VALUE=/("@(\w+)(|[.]\w+)+")/g;static FIELD_SEPARATOR=".";store;constructor(){this.store={}}register(e,n){e?void 0!==n?(this.store[e]=n,t.d(f,`#register - data \n${JSON.stringify(n)}`)):t.w(f,`#register - 'Data is not exist. Can not register data in ${e}.`):t.w(f,"#register - key argument is not exist.")}getRegisteredData(e){if(!e)return t.w(f,"#getRegisteredData - key argument is not exist."),null;if("undefined"==typeof this.store[e])return t.w(f,`#getRegisteredData - has not registered data by "${e}" key.`),null;const n=this.store[e];return t.d(f,`#getRegisteredData - registered data \n${JSON.stringify(n)}`),n}findValueFromPath(e){if(!e)return void t.w(f,"#findValueFromPath - path is empty");const n=e.replace(/"/g,"").replace(w.DYNAMIC_VALUE_FLAG,"").split(w.FIELD_SEPARATOR);let r=this.store[n[0]];for(let i=1;i<n.length;i++)r=r[n[i]],void 0===r&&(r={},t.w(f,`#findValueFromPath - found undefined value ${e} > replaced with an empty object.`)),t.i(f,`#findValueFromPath - found value ${e}/${r}`);return"string"==typeof r?`"${r}"`:"object"==typeof r&&Object.keys(r).length>0?JSON.stringify(r):r}replaceDynamicString(e){let n=JSON.stringify(e);return n=n.replace(w.REGEXP_DYNAMIC_VALUE,(e=>{const n=this.findValueFromPath(e);return t.d(f,`#replaceDynamicString - replace string ${e} > ${n}`),n})),JSON.parse(n)}merge(...e){const t={};let n=!1,r=0;const i=e.length;"boolean"==typeof e[0]&&(n=e[0],r++);const a=e=>{for(const r in e)n&&"object"==typeof e[r]?t[r]=this.merge(!0,t[r],e[r]):t[r]=e[r]};for(;r<i;r++){a(e[r])}return t}}const b="AttrDataUtil",v="data-web-log",y=`${v}-event`,S=`${v}-param`;var T={setEvent(e,n){n?(e.setAttribute(y,n),t.d(b,`#setEvent - eventType: ${n}`)):t.w(b,"#setEvent - eventType is empty")},getEvent(e){const n=e&&e.getAttribute&&e.getAttribute(y)||"";return t.d(b,"#getEvent - eventType"+(n?`: ${n}`:" is empty")),n},setRequestParam(e,n){if("string"!=typeof n&&!this.isValidRequestParam(n))throw new Error(`${b}: The value of data-web-log-param is not a valid format.`);if(n)if("string"==typeof n&&0===n.indexOf(w.DYNAMIC_VALUE_FLAG))e.setAttribute(S,n),t.d(b,`#setRequestParam - jsonData: ${n}`);else{const r=JSON.stringify(n);e.setAttribute(S,r),t.d(b,`#setRequestParam - jsonData: ${r}`)}else t.w(b,"#setRequestParam - jsonData is empty")},getRequestParam(e){const n=e&&e.getAttribute&&e.getAttribute(S)||"{}";if(0===n.indexOf(w.DYNAMIC_VALUE_FLAG))return t.d(b,`#getRequestParam resister parameter string - \n${n}`),n;let r;t.d(b,`#getRequestParam - \n${n}`);try{r=JSON.parse(n)}catch(H){throw new Error(`${b}: The parameters are not in a correct format.`)}if(!this.isValidRequestParam(r))throw new Error(`${b}: The value of data-web-log-param is not a valid format.`);return r},isValidRequestParam:e=>0===Object.keys(e).length||!!(e.data||e.meta||e.extra),getComponentName(e){let t="";const n=e;if(e.dataset.componentName)return e.dataset.componentName;if(e.id)return e.id;for(;!t&&e.parentElement&&"BODY"!==(e=e.parentElement).tagName;)if(e.dataset.componentName){t=e.dataset.componentName;break}if(""===t){if("BUTTON"===n.tagName&&n.textContent)return n.textContent.trim();if("A"===n.tagName&&n.href)return n.href}return t},getWidgetName(e){return this.getAttributeValue(e,"data-widget-name")},getServerTime(e){return this.getAttributeValue(e,"data-web-log-server-time")},getAttributeValue(e,t){let n="";for(;!n&&e&&"BODY"!==e.tagName;){if(e.getAttribute(t)){n=e.getAttribute(t);break}e=e.parentElement}return n},getTraceId(e){let t="";for(;!t&&e&&"BODY"!==e.tagName;){if(e.dataset.webLogTraceId){t=this.getCleanTraceId(e.dataset.webLogTraceId);break}e=e.parentElement}return t},getCleanTraceId(e){const t=e.match(/[\w\d]{32}/);return null===t?"":t[0]}};class I{pvid;rvid;url;referrer;constructor(){const e=window.location.href,t=document.referrer||"";this.setPvId(d.generate()),this.setRvId(""),this.setReferrer(t),this.setUrl(e)}getJSON(){const{pvid:e,rvid:t,url:n,referrer:r}=this;return{web:{pvid:e,rvid:t,url:n,referrer:r}}}setPvId(e){this.pvid=e}setRvId(e){this.rvid=e}setUrl(e){this.url=e}setReferrer(e){this.referrer=e}}var P={generateImplicitLogRequestParams(e,t,n){const r={...t};r.meta=Object.assign({},e.meta,t.meta),r.data=Object.assign({},e.data,t.data),r.data.domain=t.data?.domain||n.domain,r.data.pageName=t.data?.pageName||n.pageName,r.data.pvid=n.pvid||(new I).getJSON().web.pvid;const i=t.data?.serverTime||n.serverTime;return i&&(r.data.serverTime=i),r},generateRequestJSON(e,t,n){const{meta:r,data:i,extra:a}=e,s=r?this.generateMetaParameter(r).getJSON():{meta:{}},o=i?this.generateDataParameter(i).getJSON():{data:{}},c=this.generateExtraParameter(a||{}).getJSON();t.setEventTime((new Date).toISOString()),t.setMemberSrl();const m=t.getJSON();return g.isApp()&&(c.$webview=t.getExtraWebviewJSON(!0)),{...m,...s,...o,...c,...n}},generateMetaParameter(e){const{schemaId:n,schemaVersion:r}=e;return n&&r||t.w("RequestUtil",`#generateMetaParameter - schemaId: ${n}, schemaVersion: ${r}`),(new p).setSchemaId(n).setSchemaVersion(r)},generateDataParameter:e=>(new l).setData(e),generateExtraParameter:e=>(new h).setExtraData(e).setSentTime((new Date).toISOString()),generateEventData(e,t,n,r){const i=T.getRequestParam(t),a=n.replaceDynamicString(i);a.data=a.data||{};const s=T.getComponentName(t),o=T.getWidgetName(t);return a.data.componentName=a.data.componentName||s,a.data.widgetName=a.data.widgetName||o,a.data.eventName=a.data.eventName||`${e}_${a.data.componentName||a.data.widgetName}`,a.data.traceId=T.getTraceId(t)||r.traceId,a.data.serverTime=parseInt(T.getServerTime(t),10)||r.serverTime,a},mergeRequestParams(e={},t={}){const n={};return n.data=Object.assign({},e?.data,t?.data),n.extra=Object.assign({},e?.extra,t?.extra),n.meta=Object.assign({},e?.meta,t?.meta),n}};const E="[data-web-log-track-id]",L=`[data-widget-name]:not(${E}),[data-web-log-event='impression']:not(${E})`,R="[data-web-log-exclude='impression']";class N{commonData;commonParameter;parameterStore;campaignParams;logRequester;areaThreshold;timeThreshold;trackedElements;constructor(e,t,n,r,i,a){this.commonData=n,this.commonParameter=t,this.parameterStore=e,this.campaignParams=r,this.logRequester=i,this.trackedElements={},this.areaThreshold=a?.areaThreshold||.2,this.timeThreshold=a?.timeThreshold||1e3}initTracking(e){const t={threshold:this.areaThreshold},n=new IntersectionObserver(this.trackStatus.bind(this),t),r=e=>{e===undefined||e.dataset?.webLogTrackId||(e.dataset.webLogTrackId=d.generate(),this.trackedElements[e.dataset.webLogTrackId]=[])},i=(e,t)=>{for(const t of e){const e=t.target.closest(E);e&&n.observe(e)}};if(e)r(e),n.observe(e);else{const e=()=>{document.body.querySelectorAll(L).forEach((e=>{e.matches(R)||(r(e),n.observe(e),(e=>{new MutationObserver(i).observe(e,{childList:!0,subtree:!0})})(e))}))};e();new MutationObserver(e).observe(document.body,{childList:!0,subtree:!0})}const a=window.setInterval((()=>{this.trackImpression(n)}),1e3);window.onbeforeunload=()=>{this.trackImpression(n),a&&clearInterval(a)}}trackStatus(e,t){e.forEach((e=>{const t=e.target;if(!t.matches(R)&&e.isIntersecting&&u.isVisible(t)){const n=t.dataset.webLogTrackId,r=this.trackedElements[n]?this.trackedElements[n]:[];r.push({isVisible:e.isIntersecting,ts:e.time}),this.trackedElements[n]=r}}))}trackImpression(e){Object.keys(this.trackedElements).forEach((t=>{if(u.isVisibleLongerThanMinTime(this.trackedElements[t],this.timeThreshold)){const n=document.querySelector(`[data-web-log-track-id="${t}"]`);n&&(this.sendImpressionLog(n),delete this.trackedElements[t],e.unobserve(n))}}),this)}sendImpressionLog(e,n={}){if(e===undefined)return;const r=P.generateEventData("impression",e,this.parameterStore,this.commonData),i=Object.keys(n).length>0?P.mergeRequestParams(r,n):r,a=P.generateImplicitLogRequestParams(c,i,this.commonData),s=P.generateRequestJSON(a,this.commonParameter,this.campaignParams);this.logRequester.send(s,!0),t.d("Impression",`Send impression: ${e.dataset.widgetName||e.dataset.componentName}`)}}const O=/MSIE ([0-9]{1,}[\\.0-9]{0,})/,A=/Trident\/(\d)/i,C={isIE:()=>navigator.userAgent.toLowerCase().indexOf("msie")>-1,isIE11:()=>"Netscape"===navigator.appName&&navigator.userAgent.search("Trident")>-1,getVersion(){let e=-1;return"Microsoft Internet Explorer"===navigator.appName&&null!=O.exec(navigator.userAgent)&&(e=parseFloat(RegExp.$1)),e},hasTridentVersion:()=>null!==navigator.userAgent.match(A)};var k={isSupported(){return!(C.isIE()||this.isIE11())},isSupportXMLRequest(){return!(C.isIE()&&C.getVersion()<=9)||this.isIE11()},isIE8:()=>C.isIE()&&8===C.getVersion(),isIE11:C.isIE11,isLowerThanIE10(){return C.isIE()&&C.getVersion()<10&&!this.isIE11()}},D={add(e,t){"complete"===document.readyState||"loading"!==document.readyState&&k.isIE8()||"DOMContentLoaded"===e&&"interactive"===document.readyState?window.setTimeout(t):window.addEventListener(e,t)}};class V{startTime;endTime;optionFields;constructor(e,t){this.startTime=e,this.optionFields=t}stop(e){this.endTime=e}measureLatency(){return Math.floor(this.endTime-this.startTime)}getOptionFields(){return this.optionFields}}var q={getCookie(e){let t;const n=e+"=",r=decodeURIComponent(document.cookie).split(";");for(t=0;t<r.length;t++){let e=r[t];for(;" "===e.charAt(0);)e=e.substring(1);if(0===e.indexOf(n))return e.substring(n.length,e.length)}return""},setCookie(e,t,n,r,i,a){const s=new Date(2100,1,1),o=(e=>{const t=e.split(".");return 3!==t.length&&4!==t.length?e:e.replace(/^(?:[\w\d]+\.)?([^:/]*).*$/i,"$1")})(decodeURIComponent(document.domain)),c=[];c.push(`${e}=${encodeURIComponent(t)}`),c.push(`; expires=${n&&n.toUTCString()||s.toUTCString()}`),c.push(`; domain=${r||o}`),c.push(`; path=${i||"/"}`),c.push(a&&"; secure"),document.cookie=c.join("")}};const x="web-session-id",$="WEB_SESSION";function M(){t.d($,"start update web session id");const e=q.getCookie(x);let n;t.d($,`web session is ${JSON.stringify(e)}`),e?(t.d($,"refresh the expires of web session id"),n=e):(t.d($,"web session is not exist, generate a new web session id"),n=d.generate());const r=new Date(Date.now()+18e5);return t.d($,`update new web session: ${JSON.stringify(n)}`),function(e,t){q.setCookie(x,e,t)}(n,r),n}const j="3.2.1";class F{platform;pcid;memberSrl;libraryVersion;lang;resolution;eventTime;commonWebParameter;webSessionId;webBuildNo;constructor(){this.setLang().setMemberSrl().setPCID().setResolution().setLibraryVersion(j)}setCommonWebParameter(e){return this.commonWebParameter=e,this}setPlatform(e){return this.platform=e,this}setEventTime(e){return this.eventTime=e,this}setPCID(){const e=q.getCookie("PCID"),t=new RegExp("^\\d{23}$");return this.pcid=t.test(e)?e:this.generatePCID(),this}setMemberSrl(){const e=q.getCookie("member_srl"),t=new RegExp("^\\d+$");return this.memberSrl=t.test(e)?e:"",this}setLibraryVersion(e){return this.libraryVersion=e,this}setLang(){return this.lang=document.documentElement.lang||navigator.languages&&navigator.languages[0]||navigator.language,this}setResolution(){return this.resolution=`${window.screen.width}x${window.screen.height}`,this}setWebSessionId(){const e=M();return this.webSessionId=e,this}setWebBuildNo(e){return this.webBuildNo=e||"default",this}getJSON(){const{platform:e,pcid:t,memberSrl:n,libraryVersion:r,lang:i,resolution:a,eventTime:s,webSessionId:o,webBuildNo:c,commonWebParameter:m}=this;let d={};return m&&(d=m.getJSON()),{common:{platform:e,pcid:t,memberSrl:n,libraryVersion:r,lang:i,resolution:a,eventTime:s,webSessionId:o,webBuildNo:c,...d}}}getLibVersion(){return j}getExtraWebviewJSON(e){const t=this.commonWebParameter.getJSON(),n={eventTime:this.eventTime,pcid:this.pcid,libraryVersion:this.getLibVersion(),...t.web};if(e){const e=n.url||"",t=n.referrer||"";e.length>100&&(n.url=e.substring(0,100)+"......"),t.length>100&&(n.referrer=t.substring(0,100)+"......")}return n}generatePCID(){const e=new Date,t=[];let n;return t.push(e.getTime()),t.push(Math.random().toString().substring(2)),q.setCookie("PCID",n=t.join("").substring(0,23)),n}}function _(e){return!e||e<0?0:e}class B{getNetworkParameters(){if(!window.performance||!window.performance.timing)return{};const e=window.performance.timing;return{navigationStart:_(e.navigationStart),redirectStart:_(e.redirectStart),fetchStart:_(e.fetchStart),domainLookupStart:_(e.domainLookupStart),connectStart:_(e.connectStart),secureConnectionStart:_(e.secureConnectionStart),requestStart:_(e.requestStart),responseStart:_(e.responseStart),redirect:_(e.redirectEnd-e.redirectStart)||_(e.fetchStart-e.navigationStart),dns:_(e.domainLookupEnd-e.domainLookupStart),ssl:_(e.connectEnd-e.secureConnectionStart),connect:_(e.connectEnd-e.connectStart),request:_(e.responseStart-e.requestStart),response:_(e.responseEnd-e.responseStart)}}}const J="data-load-time",W="TTILog";class U{ttiObjects;commonFields;baseOption;serverTime;domReady;imageLoadingTime;latestImageLoadingTime;imageCount;loadedCount;syncRecorded;asyncLogs;commonParameter;webLogRequester;appLogRequester;calcType;constructor(e,t){this.ttiObjects={},this.loadedCount=0,this.asyncLogs=[],this.imageLoadingTime=0,this.latestImageLoadingTime=0,this.webLogRequester=e,this.appLogRequester=t}init(e){const{pageName:t,platform:n,platformType:r,screenType:i,extra:a,async:s=!1,calcType:o="default",applicationId:c="no_applicationId_assigned",webBuildNo:m}=e;this.commonFields={domain:"tti",logCategory:"system",logType:"performance",eventName:"tti-logger",pageName:t,platformType:r,applicationId:c,ixid:d.generate()},this.baseOption={screenType:i,extra:a,async:s},this.calcType=o||"default",this.commonParameter=(new F).setPlatform(n).setWebBuildNo(m).setWebSessionId(),this.updatePerformanceValues(s)}record(e,n={}){const r=window.performance.now();if(Object.prototype.hasOwnProperty.call(this.ttiObjects,e))return t.w(W,`Already ${e} is recording the TTI`);(n.extra||(n.extra={})).ttiRecordKey=e,n.async=!0,this.ttiObjects[e]=new V(r,n)}stop(e){if(!Object.prototype.hasOwnProperty.call(this.ttiObjects,e))return t.w(W,`${e} must first record`);const n=this.ttiObjects[e],r=(()=>(n.stop(window.performance.now()),delete this.ttiObjects[e],n.measureLatency()))();this.recordAsync(r,n.getOptionFields())}manualRecord(e={}){const t=Math.floor(window.performance.now()),n=Object.assign({},this.baseOption,{async:!0,extra:Object.assign(e,this.baseOption.extra)});this.getLatestImageLoadTime(),this.recordAsync(t,n)}logImageLoadTime(e){if(window.performance.getEntriesByName){const t=e.getAttribute("src").replace(/^(\/\/)/,`${location.protocol}$1`),n=performance.getEntriesByName(t),r=n.length>0&&n[0]||null,i=r&&r.duration||0,a=r&&r.startTime||0,s=a+i;a>0&&s>0&&(e.setAttribute(`${J}-start`,a.toString()),e.setAttribute(`${J}-end`,s.toString()))}e.setAttribute(J,window.performance.now().toString())}recordAsync(e,t){this.asyncLogs.push({tti:e,optionFields:t}),this.domReady&&this.submitAsync()}submitAsync(){this.asyncLogs.map((e=>this.submit(e.tti,Object.assign({serverTime:this.serverTime,domReady:this.domReady,imageLoadingTime:this.imageLoadingTime},e.optionFields)))),this.asyncLogs=[]}submit(e,n){const r=g.isApp(),i=this.makeParams(e,n);r?this.appLogRequester.send(i):this.webLogRequester.send(i),t.d(W,`#submitSync - tti: ${e}, serverTime: ${n.serverTime}, domReady: ${n.domReady}, imageLoadingTime: ${n.imageLoadingTime}`)}makeParams(e,t){const n={...(new B).getNetworkParameters(),url:location.href,...t.extra,calcType:this.calcType},r=(new h).setExtraData(n).setSentTime((new Date).toISOString()).getJSON();return this.commonParameter.setEventTime((new Date).toISOString()),delete t.extra,{...this.commonParameter.getJSON(),...r,meta:{schemaId:137,schemaVersion:6},data:Object.assign({tti:e},this.commonFields,t)}}submitSync(){if(!this.syncRecorded&&this.domReady){let e=this.domReady;this.imageCount>0&&(e=Math.max(this.domReady,this.latestImageLoadingTime),this.baseOption.extra=Object.assign({latestImageLoadingTime:this.latestImageLoadingTime},this.baseOption.extra)),this.syncRecorded=!0,this.submit(e,Object.assign({serverTime:this.serverTime,domReady:this.domReady,imageLoadingTime:this.imageLoadingTime},this.baseOption))}}getLatestImageLoadTime(){const e=document.querySelectorAll("img[data-load-time]"),t=this.imageCount=e.length,n=[],r=[];for(let i=0;i<t;i++){const t=Number(e[i].getAttribute(J));n.push(parseInt(e[i].getAttribute(`${J}-start`),10)),r.push(parseInt(e[i].getAttribute(`${J}-end`),10)),this.latestImageLoadingTime=this.getActualTime(Math.max(this.latestImageLoadingTime,Math.floor(t)))}n.length>0&&r.length>0&&(this.imageLoadingTime=Math.max(0,Math.floor(Math.max(...r)-Math.min(...n))))}updatePerformanceValues(e){D.add("load",(()=>{this.supportTimingApi()&&(this.serverTime=Math.max(0,window.performance.timing.responseEnd-window.performance.timing.requestStart),this.domReady=this.getActualTime(window.performance.timing.domContentLoadedEventEnd-window.performance.timing.navigationStart)),this.getLatestImageLoadTime(),!e&&this.submitSync(),this.asyncLogs.length>0&&this.submitAsync()}))}getActualTime(e){return"excludeRedirect"===this.calcType&&this.supportTimingApi()&&(e-=window.performance.timing.fetchStart-window.performance.timing.navigationStart),Math.max(0,e)}supportTimingApi(){return window.performance&&window.performance.timing}}var H,G,K,Y,X=-1,z=function(e){addEventListener("pageshow",(function(t){t.persisted&&(X=t.timeStamp,e(t))}),!0)},Q=function(){return window.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]},Z=function(){var e=Q();return e&&e.activationStart||0},ee=function(e,t){var n=Q(),r="navigate";return X>=0?r="back-forward-cache":n&&(document.prerendering||Z()>0?r="prerender":document.wasDiscarded?r="restore":n.type&&(r=n.type.replace(/_/g,"-"))),{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v3-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:r}},te=function(e,t,n){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var r=new PerformanceObserver((function(e){Promise.resolve().then((function(){t(e.getEntries())}))}));return r.observe(Object.assign({type:e,buffered:!0},n||{})),r}}catch(e){}},ne=function(e,t,n,r){var i,a;return function(s){t.value>=0&&(s||r)&&((a=t.value-(i||0))||void 0===i)&&(i=t.value,t.delta=a,t.rating=function(e,t){return e>t[1]?"poor":e>t[0]?"needs-improvement":"good"}(t.value,n),e(t))}},re=function(e){requestAnimationFrame((function(){return requestAnimationFrame((function(){return e()}))}))},ie=function(e){var t=function(t){"pagehide"!==t.type&&"hidden"!==document.visibilityState||e(t)};addEventListener("visibilitychange",t,!0),addEventListener("pagehide",t,!0)},ae=function(e){var t=!1;return function(n){t||(e(n),t=!0)}},se=-1,oe=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},ce=function(e){"hidden"===document.visibilityState&&se>-1&&(se="visibilitychange"===e.type?e.timeStamp:0,de())},me=function(){addEventListener("visibilitychange",ce,!0),addEventListener("prerenderingchange",ce,!0)},de=function(){removeEventListener("visibilitychange",ce,!0),removeEventListener("prerenderingchange",ce,!0)},ue=function(){return se<0&&(se=oe(),me(),z((function(){setTimeout((function(){se=oe(),me()}),0)}))),{get firstHiddenTime(){return se}}},ge=function(e){document.prerendering?addEventListener("prerenderingchange",(function(){return e()}),!0):e()},pe=[1800,3e3],le={passive:!0,capture:!0},he=new Date,fe=function(e,t){H||(H=t,G=e,K=new Date,ve(removeEventListener),we())},we=function(){if(G>=0&&G<K-he){var e={entryType:"first-input",name:H.type,target:H.target,cancelable:H.cancelable,startTime:H.timeStamp,processingStart:H.timeStamp+G};Y.forEach((function(t){t(e)})),Y=[]}},be=function(e){if(e.cancelable){var t=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?function(e,t){var n=function(){fe(e,t),i()},r=function(){i()},i=function(){removeEventListener("pointerup",n,le),removeEventListener("pointercancel",r,le)};addEventListener("pointerup",n,le),addEventListener("pointercancel",r,le)}(t,e):fe(t,e)}},ve=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(t){return e(t,be,le)}))},ye=[100,300],Se=[2500,4e3],Te={};class Ie{schemaID;schemaVersion;performanceObjects;commonFields;baseOption;serverTime;domReady;asyncLogs;commonParameter;webLogRequester;appLogRequester;calcType;constructor(e,t){this.performanceObjects={},this.asyncLogs=[],this.webLogRequester=e,this.appLogRequester=t}submit(e,n,r){const i=g.isApp(),a=this.makeParams(e,n,r);i?this.appLogRequester.send(a):this.webLogRequester.send(a),t.d("PerformanceLog",`#submitSync - ${e}: ${n}, serverTime: ${r.serverTime}, domReady: ${r.domReady}, imageLoadingTime: ${r.imageLoadingTime}`)}makeCommonFields(e){return{logCategory:"system",logType:"performance",eventName:"web_latency_track_log",ixid:d.generate(),...e}}makeParams(e,t,n){const{pcid:r,platform:i}=this.commonParameter.getJSON().common||{},a={...(new B).getNetworkParameters(),url:location.href,pcid:r,platform:i,...n.extra,calcType:this.calcType},s=(new h).setExtraData(a).setSentTime((new Date).toISOString()).getJSON();return this.commonParameter.setEventTime((new Date).toISOString()),delete n.extra,{...this.commonParameter.getJSON(),...s,meta:{schemaId:this.schemaID,schemaVersion:this.schemaVersion},data:Object.assign({[e]:t},this.commonFields,n)}}}class Pe extends Ie{fcp;constructor(e,t){super(e,t),this.schemaID=10797,this.schemaVersion=2,this.fcp=-1}init(e){const{pageName:t,platform:n,webBuildNo:r,platformType:i,screenType:a,extra:s,async:o=!1,applicationId:c="no_applicationId_assigned"}=e;this.commonFields=this.makeCommonFields({domain:"fcp",pageName:t,platformType:i,applicationId:c}),this.baseOption={screenType:a,extra:s,async:o},this.commonParameter=(new F).setPlatform(n).setWebBuildNo(r).setWebSessionId(),this.onFCP()}onFCP(){!function(e,t){t=t||{},ge((function(){var n,r=ue(),i=ee("FCP"),a=te("paint",(function(e){e.forEach((function(e){"first-contentful-paint"===e.name&&(a.disconnect(),e.startTime<r.firstHiddenTime&&(i.value=Math.max(e.startTime-Z(),0),i.entries.push(e),n(!0)))}))}));a&&(n=ne(e,i,pe,t.reportAllChanges),z((function(r){i=ee("FCP"),n=ne(e,i,pe,t.reportAllChanges),re((function(){i.value=performance.now()-r.timeStamp,n(!0)}))})))}))}((e=>{console.log("test web-vitals: ","fcp -- ",e),this.fcp=Math.round(e.value)||-1,this.goSubmit()}))}goSubmit(e={}){super.submit("fcp",this.fcp,e)}}const Ee=e=>{const{left:t,right:n,top:r,bottom:i,width:a,height:s}=e.getBoundingClientRect();if(!a||!s)return 0;const o=n>window.innerWidth?window.innerWidth-t:t>=0&&n>=0?a:t<0&&n>=0?n:0,c=i>window.innerHeight?window.innerHeight-r:r>=0&&i>=0?s:r<0&&i>=0?i:0;return Math.max(o*c/(a*s),0)},Le=new Map([["VIDEO",5],["CANVAS",5],["IMG",2],["SVG",2]]),Re=["SCRIPT","STYLE","META","HEAD","LINK"],Ne="fmp-tag";let Oe;class Ae extends Ie{fmp;observe;markCount=0;resolveFn;rejectFn;statusObserve=[];entries={};constructor(e,t){super(e,t),this.resolveFn=null,this.rejectFn=null,this.schemaID=10798,this.schemaVersion=1,this.checkMarkStatus(document.body)?this.activeMark():this.passiveMark()}init(e){const{pageName:t,platform:n,webBuildNo:r,platformType:i,screenType:a,extra:s,async:o=!1,applicationId:c="no_applicationId_assigned"}=e;this.commonFields=this.makeCommonFields({domain:"fmp",pageName:t,platformType:i,applicationId:c}),this.baseOption={screenType:a,extra:s,async:o},this.commonParameter=(new F).setPlatform(n).setWebBuildNo(r).setWebSessionId(),this.onFMP()}onFMP(){Oe=setTimeout((()=>{this.getFirstMeaningFulPaint().then((e=>{this.fmp=Math.round(e)||-1,this.fmp>0?this.goSubmit():(clearTimeout(Oe),this.onFMP())}))["catch"]((()=>{this.fmp=-1}))}),200)}getFirstMeaningFulPaint(){return new Promise(((e,t)=>{this.resolveFn=e,this.rejectFn=t,"complete"===document.readyState?this.getCoreElement():window.addEventListener("load",(()=>{this.getCoreElement()}))}))}checkMarkStatus(e){if(!e)return!1;if(e.getAttribute(Ne))return!0;const t=e.children;for(let e=0;e<t.length;e++){const n=t[e];if(this.checkMarkStatus(n))return!0}return!1}getCoreElement(){if(!("MutationObserver"in window))return this.rejectFn(),void console.error("browser doesn't support mutationObserver api");this.observe.disconnect(),performance.getEntries().forEach((e=>{this.entries[e.name]=e.responseEnd}));const e=this.getTreeWeight(document.body);let t=null;if(e.childList.forEach((e=>{t&&t.weightScore?e.weightScore>t.weightScore&&(t=e):t=e})),!t)return void this.resolveFn(0);const n=this.filterEls(t.elementArr);this.resolveFn(this.getElementTiming(n))}activeMark(){}passiveMark(){this.getFirstSnapShot(),this.observe=new MutationObserver((()=>{const e=performance.now();this.markCount++,this.statusObserve.push({time:e}),this.setTag(document.body,this.markCount)})),this.observe.observe(document,{childList:!0,subtree:!0})}getFirstSnapShot(){const e=performance.now();this.setTag(document.body,this.markCount),this.statusObserve.push({time:e})}getTreeWeight(e){if(!e)return null;const t=[],n=e.children;for(let e=0;e<n.length;e++){const r=n[e];if(!r.getAttribute(Ne))continue;const i=this.getTreeWeight(r);i?.weightScore&&t.push(i)}return this.calculateScore(e,t)}setTag(e,t){const n=e.tagName;if(Re.indexOf(n)>-1)return;const r=e.children;for(let e=0;e<r.length;e++){const n=r[e];if(!n.getAttribute(Ne)){if(!Ee(n))continue;n.setAttribute(Ne,`${t}`)}this.setTag(n,t)}}getElementTiming(e){let t=0;return e.forEach((e=>{let n=0;if(1===e.weight){const t=parseInt(e.element.getAttribute(Ne),10);n=this.statusObserve[t].time}else if(2===e.weight){if("IMG"===e.element.tagName)n=this.entries[e.element.src];else if("SVG"===e.element.tagName){const t=parseInt(e.element.getAttribute(Ne),10);n=this.statusObserve[t].time}}else if(5===e.weight)if("VIDEO"===e.element.tagName)n=this.entries[e.element.src];else if("CANVAS"===e.element.tagName){const t=parseInt(e.element.getAttribute(Ne),10);n=this.statusObserve[t].time}t=Math.max(t,n)})),t}filterEls(e){if(1===e.length)return e;let t=0;e.forEach((e=>{t+=e.weightScore}));const n=t/e.length;return e.filter((e=>e.weightScore>n))}calculateScore(e,t){const{width:n,height:r}=e.getBoundingClientRect(),i=Le.get(e.tagName)||1;let a=0;t.forEach((e=>{a+=e.weightScore}));let s=Ee(e)?n*r*i*Ee(e):0,o=[{element:e,weight:i,weightScore:s}];return(s<a||0===s)&&(s=a,o=[],t.forEach((e=>{o=o.concat(e.elementArr)}))),e.setAttribute("fmp_weight",`${s}`),{weightScore:s,elementArr:o,childList:t,element:e}}goSubmit(){super.submit("fmp",this.fmp,{})}}class Ce extends Ie{lcp;constructor(e,t){super(e,t),this.schemaID=11778,this.schemaVersion=1,this.lcp=-1}init(e){const{pageName:t,platform:n,webBuildNo:r,platformType:i,screenType:a,extra:s,async:o=!1,applicationId:c="no_applicationId_assigned"}=e;this.commonFields={domain:"lcp",logCategory:"system",logType:"performance",eventName:"web_latency_track_log",pageName:t,platformType:i,applicationId:c,ixid:d.generate()},this.baseOption={screenType:a,extra:s,async:o},this.commonParameter=(new F).setPlatform(n).setWebBuildNo(r).setWebSessionId(),this.onLCP()}onLCP(){!function(e,t){t=t||{},ge((function(){var n,r=ue(),i=ee("LCP"),a=function(e){var t=e[e.length-1];t&&t.startTime<r.firstHiddenTime&&(i.value=Math.max(t.startTime-Z(),0),i.entries=[t],n())},s=te("largest-contentful-paint",a);if(s){n=ne(e,i,Se,t.reportAllChanges);var o=ae((function(){Te[i.id]||(a(s.takeRecords()),s.disconnect(),Te[i.id]=!0,n(!0))}));["keydown","click"].forEach((function(e){addEventListener(e,(function(){return setTimeout(o,0)}),!0)})),ie(o),z((function(r){i=ee("LCP"),n=ne(e,i,Se,t.reportAllChanges),re((function(){i.value=performance.now()-r.timeStamp,Te[i.id]=!0,n(!0)}))}))}}))}((e=>{this.lcp=Math.round(e.value)||-1,this.goSubmit()}),{reportAllChanges:!0})}goSubmit(){super.submit("lcp",this.lcp,{})}}class ke extends Ie{fid;constructor(e,t){super(e,t),this.schemaID=11779,this.schemaVersion=1,this.fid=-1}init(e){const{pageName:t,webBuildNo:n,platform:r,platformType:i,screenType:a,extra:s,async:o=!1,applicationId:c="no_applicationId_assigned"}=e;this.commonFields={domain:"fid",logCategory:"system",logType:"performance",eventName:"web_latency_track_log",pageName:t,platformType:i,applicationId:c,ixid:d.generate()},this.baseOption={screenType:a,extra:s,async:o},this.commonParameter=(new F).setPlatform(r).setWebBuildNo(n).setWebSessionId(),this.onFID()}onFID(){!function(e,t){t=t||{},ge((function(){var n,r=ue(),i=ee("FID"),a=function(e){e.startTime<r.firstHiddenTime&&(i.value=e.processingStart-e.startTime,i.entries.push(e),n(!0))},s=function(e){e.forEach(a)},o=te("first-input",s);n=ne(e,i,ye,t.reportAllChanges),o&&ie(ae((function(){s(o.takeRecords()),o.disconnect()}))),o&&z((function(){var r;i=ee("FID"),n=ne(e,i,ye,t.reportAllChanges),Y=[],G=-1,H=null,ve(addEventListener),r=a,Y.push(r),we()}))}))}((e=>{this.fid=Math.round(e.value)||-1,this.goSubmit()}),{reportAllChanges:!0})}goSubmit(){super.submit("fid",this.fid,{})}}var De="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Ve(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e["default"]:e}var qe=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},xe="object"==typeof De&&De&&De.Object===Object&&De,$e="object"==typeof self&&self&&self.Object===Object&&self,Me=xe||$e||Function("return this")(),je=Me,Fe=function(){return je.Date.now()},_e=/\s/;var Be=function(e){for(var t=e.length;t--&&_e.test(e.charAt(t)););return t},Je=Be,We=/^\s+/;var Ue=function(e){return e?e.slice(0,Je(e)+1).replace(We,""):e},He=Me.Symbol,Ge=He,Ke=Object.prototype,Ye=Ke.hasOwnProperty,Xe=Ke.toString,ze=Ge?Ge.toStringTag:undefined;var Qe=function(e){var t=Ye.call(e,ze),n=e[ze];try{e[ze]=undefined;var r=!0}catch(H){}var i=Xe.call(e);return r&&(t?e[ze]=n:delete e[ze]),i},Ze=Object.prototype.toString;var et=Qe,tt=function(e){return Ze.call(e)},nt=He?He.toStringTag:undefined;var rt=function(e){return null==e?e===undefined?"[object Undefined]":"[object Null]":nt&&nt in Object(e)?et(e):tt(e)},it=function(e){return null!=e&&"object"==typeof e};var at=Ue,st=qe,ot=function(e){return"symbol"==typeof e||it(e)&&"[object Symbol]"==rt(e)},ct=/^[-+]0x[0-9a-f]+$/i,mt=/^0b[01]+$/i,dt=/^0o[0-7]+$/i,ut=parseInt;var gt=qe,pt=Fe,lt=function(e){if("number"==typeof e)return e;if(ot(e))return NaN;if(st(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=st(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=at(e);var n=mt.test(e);return n||dt.test(e)?ut(e.slice(2),n?2:8):ct.test(e)?NaN:+e},ht=Math.max,ft=Math.min;var wt=function(e,t,n){var r,i,a,s,o,c,m=0,d=!1,u=!1,g=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var n=r,a=i;return r=i=undefined,m=t,s=e.apply(a,n)}function l(e){var n=e-c;return c===undefined||n>=t||n<0||u&&e-m>=a}function h(){var e=pt();if(l(e))return f(e);o=setTimeout(h,function(e){var n=t-(e-c);return u?ft(n,a-(e-m)):n}(e))}function f(e){return o=undefined,g&&r?p(e):(r=i=undefined,s)}function w(){var e=pt(),n=l(e);if(r=arguments,i=this,c=e,n){if(o===undefined)return function(e){return m=e,o=setTimeout(h,t),d?p(e):s}(c);if(u)return clearTimeout(o),o=setTimeout(h,t),p(c)}return o===undefined&&(o=setTimeout(h,t)),s}return t=lt(t)||0,gt(n)&&(d=!!n.leading,a=(u="maxWait"in n)?ht(lt(n.maxWait)||0,t):a,g="trailing"in n?!!n.trailing:g),w.cancel=function(){o!==undefined&&clearTimeout(o),m=0,r=c=i=o=undefined},w.flush=function(){return o===undefined?s:f(pt())},w},bt=wt,vt=qe;var yt=Ve((function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return vt(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),bt(e,t,{leading:r,maxWait:t,trailing:i})}));const St={},Tt={};let It;function Pt(e,t){St[e]=St[e]||[],St[e].push(t),function(e){if(Tt[e])return;if("history"!==(Tt[e]=!0,e))return;!function(){if(!function(){const e=window.chrome,t=e&&e.app&&e.app.runtime,n="history"in window&&!!window.history.pushState&&!!window.history.replaceState;return!t&&n}())return;const e=window.onpopstate;function t(e){return function(...t){const n=t.length>2?t[2]:undefined;if(n){const e=It,t=String(n);It=t,Et("history",{from:e,to:t})}return e.apply(this,t)}}window.onpopstate=function(...t){const n=window.location.href,r=It;if(It=n,Et("history",{from:r,to:n}),e)try{return e.apply(this,t)}catch(i){}},Lt(window.history,"pushState",t),Lt(window.history,"replaceState",t)}()}(e)}function Et(e,t){if(e&&St[e])for(const n of St[e]||[])try{n(t)}catch(H){}}function Lt(e,t,n){if(!(t in e))return;const r=e[t],i=n(r);if("function"==typeof i)try{!function(e,t){const n=t.prototype||{};e.prototype=t.prototype=n,function(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0})}(e,"__sentry_original__",t)}(i,r)}catch(a){}e[t]=i}class Rt extends Ie{autoSendPageView;constructor(e,t,n){super(e,t),this.schemaID=10943,this.schemaVersion=4,this.autoSendPageView=n,this.reportPageView=yt(this.reportPageView.bind(this),1e3)}init(e){const{pageName:t,platform:n,webBuildNo:r,platformType:i,screenType:a,extra:s,async:o=!1,applicationId:c="no_applicationId_assigned"}=e;this.commonFields=this.makeCommonFields({eventName:"web_page_view",domain:"page view",pageName:t,platformType:i,applicationId:c}),this.baseOption={screenType:a,extra:s,async:o},this.commonParameter=(new F).setPlatform(n).setWebBuildNo(r).setWebSessionId(),this.startTrackingPageView()}startTrackingPageView(){this.autoSendPageView||this.reportPageView(this.toUrlObj(location.href)),Pt("history",(({to:e=null,from:t=""})=>{const n=this.toUrlObj(e);n&&(this.isSameRoute(t,e)||this.reportPageView(n,t))}))}reportPageView(e,t=""){const n={path:e.pathname,searchParams:e.searchParams.toString(),origin:e.origin,referrer:t,title:document&&document.title||"",hash:e.hash,viewCount:1,userAgent:"undefined"!=typeof window&&window.navigator&&window.navigator.userAgent};this.commonParameter.setCommonWebParameter(new I),this.submit("url",e.toString(),n)}isSameRoute(e,t){const n=window.checkIsSameRouteForPageView||function(){return!1};try{return n(e,t)}catch(H){return!1}}toUrlObj(e){if(null===e)return null;try{return new URL(e,location.origin)}catch(H){return null}}}var Nt={COOKIE:{PCID:"PCID",MEMBERSRL:"member_srl",ISAPP:"ISAPP",CAMPAIGN:["trac_src","trac_spec","trac_sid","trac_lptag","trac_itime","trac_ctag","trac_appver","trac_addtag"]}},Ot={getCampaignParameter(){const e={};return Nt.COOKIE.CAMPAIGN.map((t=>{const n=t.replace(/^trac_/,""),r=q.getCookie(t).replace(/"/g,"");e[n]="0"!==r&&r||""})),e.src&&e.spec&&{campaign:e}||{}}};class At{requestInterceptor=[];useRequestInterceptors(e){this.useRequestInterceptor(e)}useRequestInterceptor(e){try{(Array.isArray(e)?e:[e]).forEach((e=>{"function"==typeof e&&this.requestInterceptor.push(e)}))}catch(H){t.d(At.name,`#useRequestInterceptor error - ${H.message}`)}}runRequestInterceptor(e){return this.requestInterceptor.forEach((n=>{try{const t=n(e);t&&(e=t)}catch(H){t.d(At.name,"#submit - Unexpected request interceptor")}})),e}}const Ct="WebLogRequester",kt="INVALID_PAYLOAD",Dt="INTERNAL_ERROR";class Vt{singleSubmitEndpoint;logInterceptor;constructor({singleSubmitEndpoint:e},t){this.logInterceptor=t||new At,this.singleSubmitEndpoint=e}async send(e){const n=this.logInterceptor.runRequestInterceptor(e);try{return"function"==typeof fetch?await this.fetchRequest(n):await this.sendXMLHttpRequest(n)}catch(r){throw t.e(Ct,r.message),r}}sendSync(e){const n=new Image,r=`record=${encodeURIComponent(JSON.stringify(e))}`;n.src=`${this.singleSubmitEndpoint}?${r}`,t.i(Ct,"#sendLoggingRequest - sendSync : success")}isValidResponse(e){const t=(e.responseText?JSON.parse(e.responseText):{}).type;return!(t&&(t===Dt||t===kt))}async fetchRequest(e){const n=this.convertJsonToString(e),r=new Headers({"Content-Type":"text/plain"}),i=await fetch(this.singleSubmitEndpoint,{method:"POST",body:n,headers:r,keepalive:!0});if(200!==i.status)throw new Error(`#fetch response error - send data \n${i.status} - ${i.statusText}`);try{const e=await i.json();t.i(Ct,`#fetch succeeded - ${e.responseText}`)}catch(H){t.e(Ct,`#fetch error - ${H.message}`)}}sendXMLHttpRequest(e){return new Promise(((n,r)=>{const i=new XMLHttpRequest,a=this.convertJsonToString(e);let s=!1;i.open("POST",this.singleSubmitEndpoint,!0),i.setRequestHeader("Content-Type","text/plain"),i.onload=()=>{const{readyState:e,status:a,statusText:o,responseText:c}=i;if(s=e===XMLHttpRequest.DONE&&200===i.status&&this.isValidResponse(i),s)t.i(Ct,`#sendXMLHttpRequest - onload\n status: ${a}, statusText: ${o}, responseText: ${c}`),n({status:a,statusText:o,responseText:c});else{r(new Error(`#sendXMLHttpRequest - onload\n status: ${a}, statusText: ${o}, responseText: ${c}`))}},i.onerror=()=>{const{status:e,statusText:t,responseText:n}=i;r(new Error(`#sendXMLHttpRequest - onerror\n status:${e}, statusText: ${t}, responseText: ${n}`))},i.send(a),t.d(Ct,`#sendXMLHttpRequest - send data \n${a}`)}))}convertJsonToString(e){return JSON.stringify(e||{})}}const qt="AppLogRequester";class xt{logInterceptor;constructor(e){this.logInterceptor=e||new At}send(e){const n=this.logInterceptor.runRequestInterceptor(e),r=JSON.stringify(n);if(g.hasAndroidFunction())t.d(qt,"#send - using window.CoupangAppTrackin.logEvent function"),window.CoupangAppTracking.logEvent(r);else{if(!g.hasIOSFunction())return void t.w(qt,"#send - Not found App Function.");t.d(qt,"#send - using window.webkit.messageHandlers.callBackHandler.postMessage function"),window.webkit.messageHandlers.callBackHandler.postMessage(r)}t.i(qt,`#sendToApp - jsonString \n ${r}`)}}class $t{appLogRequester;webLogRequester;constructor(e,t){this.webLogRequester=e,this.appLogRequester=t}send(e,t){return g.isApp()?(this.appLogRequester.send(e),Promise.resolve()):t?this.webLogRequester.send(e):(this.webLogRequester.sendSync(e),Promise.resolve())}}class Mt{commonData;commonParameter;parameterStore;campaignParams;logRequester;constructor(e,t,n,r,i){this.commonData=n,this.commonParameter=t,this.parameterStore=e,this.campaignParams=r,this.logRequester=i}clickHandler(e){const n=e.target,r=u.getElemToTrackForClick(n);if(r){const e=P.generateEventData("click",r,this.parameterStore,this.commonData),n=P.generateImplicitLogRequestParams(o,e,this.commonData),i=P.generateRequestJSON(n,this.commonParameter,this.campaignParams);this.logRequester.send(i,!0),t.d("Click","#trigger click event")}}}const jt="WebLog",Ft=["click","mouseenter","mouseleave","hold","scroll","swipe","keyup","keydown"],_t="data-app-code",Bt="data-host",Jt="data-platform",Wt="data-market",Ut="data-service",Ht="data-mode",Gt="data-auto-send-pageview",Kt="data-private-elb",Yt="data-tti",Xt="data-v2-api",zt="data-fmp",Qt="data-auto-send-spa-pageview",Zt="data-page-name",en="data-domain",tn="data-web-log-trace-id",nn="data-web-log-server-time",rn="data-sdp-visit-key",an="data-web-build-no",sn="data-web-log-impression-area",on="data-web-log-impression-time";class cn{platform;campaignParameter;commonParameter;webLogRequester;appLogRequester;logRequester;logInterceptor;parameterStore;configResolver;commonData;autoSendPageView;constructor(){if(window.CoupangWebLog)return;const e=document.getElementById("coupang-web-log");if(this.logInterceptor=new At,e){const n=e.getAttribute(Ht)||"production";"production"!==n&&t.setDebugMode();const r={reportSpaPageViewLog:e.getAttribute(Qt)},i={appCode:e.getAttribute(_t)||undefined,host:e.getAttribute(Bt)||undefined,platform:e.getAttribute(Jt)||undefined,market:e.getAttribute(Wt)||undefined,service:e.getAttribute(Ut)||undefined,domain:e.getAttribute(en)||undefined,pageName:e.getAttribute(Zt)||"",traceId:e.getAttribute(tn)||undefined,serverTime:parseInt(e.getAttribute(nn),10)||Date.now(),impressionAreaThreshold:parseFloat(e.getAttribute(sn))||undefined,impressionTimeThreshold:parseFloat(e.getAttribute(on))||undefined,mode:n,useAutoSendPageViewLog:"true"===e.getAttribute(Gt),privateELB:e.getAttribute(Kt)||"auto",tti:JSON.parse(e.getAttribute(Yt)),useV2API:"true"===e.getAttribute(Xt),fmp:"true"===e.getAttribute(zt),reportSpaPageViewLog:null===r.reportSpaPageViewLog||"true"===e.getAttribute(Qt),sdpVisitKey:e.getAttribute(rn)||"",webBuildNo:e.getAttribute(an)||""};t.d(jt,"#constructor - use custom attribute(data-platform, data-service, data-mode, data-auto-send-pageview) for initialize"),this.init(i)}else t.d(jt,"#constructor - Not found script tag(#coupang-web-log) for initialize")}init(e){const{tti:n,host:r,serverTime:i,impressionAreaThreshold:a,impressionTimeThreshold:o,appCode:c="coupang",mode:m="production",platform:d="web",market:u="KR",service:p="coupang",domain:l="coupang",pageName:h="",traceId:f="",useAutoSendPageViewLog:b=!1,privateELB:v="auto",useV2API:y=!1,reportSpaPageViewLog:S=!0,sdpVisitKey:P="",webBuildNo:E="default"}=e;if(t.d(jt,`#init -\n${JSON.stringify(e,undefined,2)}`),this.configResolver=new s({appCode:c||p,host:r,market:u,mode:m,privateELB:v,useV2API:y}),this.webLogRequester=new Vt({...this.configResolver.resolveEndpoints()},this.logInterceptor),this.appLogRequester=new xt(this.logInterceptor),this.logRequester=new $t(this.webLogRequester,this.appLogRequester),this.campaignParameter=Ot.getCampaignParameter(),this.platform=g.getPlatform(d),this.commonParameter=(new F).setPlatform(this.platform).setWebBuildNo(E).setWebSessionId(),this.parameterStore=new w,this.commonData={domain:l,pageName:h,serverTime:i,traceId:T.getCleanTraceId(f),sdpVisitKey:P},this.autoSendPageView=b,this.autoSendPageView?this.autoSendPageViewLog():(this.commonParameter.setCommonWebParameter(new I),this.commonData.pvid=this.commonParameter.getJSON()?.common?.web?.pvid||""),window.addEventListener("DOMContentLoaded",(()=>{this.trackImpression({options:{areaThreshold:a,timeThreshold:o}}),this.trackClick(),this.bindEvent(Ft)})),n&&!window.ttiSubmit){const e=new U(this.webLogRequester,this.appLogRequester);t.d(jt,"#init - Active 'tti-logger'"),e.init({platform:d,webBuildNo:E,...n}),window.ttiSubmit=e.manualRecord.bind(e),window.ttiRecord=e.record.bind(e),window.ttiStop=e.stop.bind(e),window.logImageLoadTime=e.logImageLoadTime.bind(e)}try{this.initPerfMetrics({platform:d,webBuildNo:E,...n}),S&&this.initSpaPageViewLog({platform:d,webBuildNo:E,...n})}catch(H){t.e(jt,`initPerfMetrics or initPageViewLog error: ${H.message}`)}return this}initPerfMetrics(e,t=!1){[{name:"FCP",constructor:Pe},{name:"FMP",constructor:Ae},{name:"LCP",constructor:Ce},{name:"FID",constructor:ke}].forEach((({name:n,constructor:r})=>{if(t||"FMP"!==n){new r(this.webLogRequester,this.appLogRequester).init(e)}}))}useRequestInterceptor(e){this.logInterceptor.useRequestInterceptor(e)}initSpaPageViewLog(e){new Rt(this.webLogRequester,this.appLogRequester,this.autoSendPageView).init(e)}autoSendPageViewLog(){const e=document.querySelector("[data-web-log-event=pageview]"),n=this.getRequestParam(e),r=this.parameterStore.replaceDynamicString(n);this.commonParameter.setCommonWebParameter(new I),this.commonData.pvid=this.commonParameter.getJSON()?.common?.web?.pvid||"";const i=P.generateImplicitLogRequestParams(m,r,this.commonData),a=P.generateRequestJSON(i,this.commonParameter,this.campaignParameter);this.logRequester.send(a,!0),t.d(jt,`#autoSendPageViewLog data: ${JSON.stringify(a)}`),t.d(jt,"#autoSendPageViewLog - sent")}registerParameter(e,t){this.parameterStore.register(e,t)}getRegisteredParameter(e){return this.parameterStore.getRegisteredData(e)}setEvent(e,t){T.setEvent(e,t)}getEvent(e){return T.getEvent(e)}setRequestParam(e,t){T.setRequestParam(e,t)}getRequestParam(e){return T.getRequestParam(e)}submit(e,t){let n=!1,r=!0;"boolean"==typeof t?n=t:t&&"object"==typeof t&&(n=!!t.isPVLog,r=!!t.isAsync),n&&(this.commonParameter.setCommonWebParameter(new I),this.commonData.sdpVisitKey&&(e.data.sdpVisitKey=this.commonData.sdpVisitKey)),this.commonParameter.setWebSessionId();const i=P.generateRequestJSON(e,this.commonParameter,this.campaignParameter);return this.logRequester.send(i,r)}trackImpression(e){if(null===e.element)return;const t=new N(this.parameterStore,this.commonParameter,this.commonData,this.campaignParameter,this.logRequester,e?.options);e?.triggerNow&&e?.element?t.sendImpressionLog(e.element,e.customData):"IntersectionObserver"in window&&t.initTracking(e?.element)}trackClick(){const e=new Mt(this.parameterStore,this.commonParameter,this.commonData,this.campaignParameter,this.logRequester);document.addEventListener("click",e.clickHandler.bind(this),!0)}generateCommonParameter(){return(new F).setPlatform(this.platform)}generateMetaParameter(e){return P.generateMetaParameter(e)}generateDataParameter(e){return P.generateDataParameter(e)}generateExtraParameter(e){return(new h).setExtraData(e).setSentTime((new Date).toISOString())}generateRequestJSON(e){return P.generateRequestJSON(e,this.commonParameter,this.campaignParameter)}bindEvent(e){const n=e=>{const n=e.type;let r,i=e.target,a=!1;for(;!a&&i;){if(r=this.getEvent(i),r&&r===n){a=!0;break}i=i.parentNode}if(!0===a){t.d(jt,`#bindEvent - matched ${n} eventType`);const e=this.getRequestParam(i);this.submit(this.parameterStore.replaceDynamicString(e))}};D.add("load",(()=>{e.forEach((e=>{t.d(jt,`#bindEvent - addEventListener eventType: ${e}`),document.addEventListener(e,n,!0)}))}))}}if(!k.isSupported()){let e;const t=function(){};for(e in cn.prototype)"function"==typeof cn.prototype[e]&&(cn.prototype[e]=t)}return new cn}));
//# sourceMappingURL=web-log.umd.min.js.map
